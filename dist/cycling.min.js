!function(){var t={886:function(){}},e={};function n(o){var i=e[o];if(void 0!==i)return i.exports;var a=e[o]={exports:{}};return t[o](a,a.exports,n),a.exports}n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,{a:e}),e},n.d=function(t,e){for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},function(){"use strict";n(886);let t=[];function e(e,n,c){const r=document.getElementById("calendar");r.innerHTML="";["一","二","三","四","五","六","日"].forEach((t=>{const e=document.createElement("div");e.className="calendar-week-header",e.innerText=t,r.appendChild(e)}));const l=i().toISOString().split("T")[0];let d=new Date(n);d.setUTCHours(0,0,0,0),t=[];let u=null;function m(e,n){const o=document.createElement("div");o.className="day-container";const i=document.createElement("span");i.className="date-number",i.innerText=e.getUTCDate(),o.appendChild(i);const a=n.find((t=>t.activity_time===e.toISOString().split("T")[0]));a&&t.push(a);const s=a?Math.min(parseFloat(a.riding_distance)/4,24):2,c=document.createElement("div");return c.className="activity-indicator",c.style.width=`${s}px`,c.style.height=`${s}px`,a||c.classList.add("no-activity"),c.style.left="50%",c.style.top="50%",o.appendChild(c),o.addEventListener("mouseenter",(()=>{e.toDateString()===(new Date).toDateString()?(i.style.opacity="0",c.style.opacity="1"):u&&(u.querySelector(".date-number").style.opacity="0",u.querySelector(".activity-indicator").style.opacity="1")})),o.addEventListener("mouseleave",(()=>{e.toDateString()===(new Date).toDateString()?(i.style.opacity="1",c.style.opacity="0"):u&&(u.querySelector(".date-number").style.opacity="1",u.querySelector(".activity-indicator").style.opacity="0")})),e.toDateString()===(new Date).toDateString()&&(u=o,o.classList.add("today"),c.style.backgroundColor="#242428",i.style.color="#242428",i.style.opacity="1",c.style.opacity="0"),o}(async function(){for(let t=0;t<c;t++)for(let t=0;t<7;t++){if(d.toISOString().split("T")[0]>l)return;const t=m(d,e);r.appendChild(t),await new Promise((t=>setTimeout(t,30))),d.setUTCDate(d.getUTCDate()+1)}})().then((()=>{!function(){const e=document.getElementById("barChart");e.innerHTML="";const n=s(i(),21),o={};let c=new Date(n);c.setUTCHours(0,0,0,0);for(let t=0;t<4;t++){const t=new Date(c),e=new Date(t);e.setUTCDate(t.getUTCDate()+6);const n=`${t.toISOString().split("T")[0]} - ${e.toISOString().split("T")[0]}`;o[n]=0,c.setUTCDate(c.getUTCDate()+7)}t.forEach((t=>{const e=function(t){const e=t.getDay(),n=(0===e?-6:1)-e,o=new Date(t);return o.setDate(o.getDate()+n),o}(new Date(t.activity_time)),n=new Date(e);n.setUTCDate(e.getUTCDate()+6);const i=`${e.toISOString().split("T")[0]} - ${n.toISOString().split("T")[0]}`;void 0!==o[i]&&(o[i]+=parseFloat(t.riding_distance))}));const r=Math.max(...Object.values(o),0);Object.keys(o).forEach((t=>{const n=o[t],i=document.createElement("div");i.className="bar-container";const s=document.createElement("div");s.className="bar";const c=r>0?n/r*190:0;s.style.setProperty("--bar-width",`${c}px`);const l=document.createElement("div");l.className="cycling-kilometer",l.innerText="0 km";const d=a(),u=a();i.style.position="relative",s.appendChild(l),i.appendChild(s),i.appendChild(d),i.appendChild(u),e.appendChild(i),s.style.width="0",s.offsetHeight,s.style.transition="width 1s ease-out",s.style.width=`${c}px`,l.style.opacity="1",function(t,e,n,o,i=!1){const a=performance.now();function s(){const e=performance.now()-a,c=Math.min(e/o,1),r=(c*n).toFixed(2);t.innerText=i?`${r} km`:`${r}h`,c<1?requestAnimationFrame(s):t.innerText=i?`${n.toFixed(2)} km`:`${n.toFixed(2)}h`}s()}(l,0,n,1e3,!0),function(t,e,n,o){let i,a;t.addEventListener("mouseenter",(()=>{clearTimeout(i),clearTimeout(a);const t=o>140?"这周干的还不错":"偷懒了啊";e.innerText=t,e.classList.add("show"),a=setTimeout((()=>{e.classList.remove("show")}),700)})),t.addEventListener("mouseleave",(()=>{i=setTimeout((()=>{e.classList.remove("show")}),700)})),t.addEventListener("click",(()=>{n.innerText="一起来运动吧！",n.classList.add("show"),setTimeout((()=>{n.classList.remove("show")}),700),e.classList.remove("show"),clearTimeout(i),clearTimeout(a)}))}(s,d,u,n)}))}(),o()}))}function o(t){const e=document.getElementById("totalCount"),n=document.getElementById("milesRiddenThisYear"),o=document.getElementById("totalTitle");if(!e||!n||!o)return;const i=e.querySelector("#ridingTimeThisYearValue"),a=n.querySelector("#milesRiddenThisYearValue"),s=e.querySelector(".loading-spinner"),r=n.querySelector(".loading-spinner");s.classList.add("active"),r.classList.add("active");const l=(new Date).getFullYear();o.textContent=`${l} 骑行总时长`;const d=t.filter((t=>new Date(t.activity_time).getFullYear()===l)),u=d.reduce(((t,e)=>t+parseFloat(e.moving_time)||0),0),m=function(t){return t.reduce(((t,e)=>t+parseFloat(e.riding_distance)||0),0)}(d);c(i,u,1e3,50,!1),c(a,m,1e3,50,!0),setTimeout((()=>{console.log(m.toFixed(2)),i.textContent=`${u.toFixed(2)} h`,a.textContent=`${m.toFixed(2)} km`,s.classList.remove("active"),r.classList.remove("active")}),1e3)}function i(){const t=new Date;return new Date(t.getTime()+288e5)}function a(){const t=document.createElement("div");return t.className="message-box",t}function s(t,e){const n=t.getUTCDay(),o=0===n?6:n-1,i=new Date(t);return i.setUTCDate(t.getUTCDate()-o-e),i}function c(t,e,n,o,i=!1){const a=e/(n/o);let s=0;const c=setInterval((()=>{s+=a,s>=e&&(s=e,clearInterval(c)),t.textContent=i?`${s.toFixed(2)} km`:`${s.toFixed(2)} h`}),o);setTimeout((()=>{t.textContent=i?`${e.toFixed(2)} km`:`${e.toFixed(2)} h`}),n)}!async function(){const t=s(i(),21),n=await async function(){return(await fetch("https://cos.lhasa.icu/data/cycling_data.json")).json()}();e(n,t,4),o(n)}()}()}();